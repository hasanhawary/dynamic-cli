#!/usr/bin/env php
<?php
// Show all errors
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// Attempt to load autoload
$autoloadPaths = [
    __DIR__ . '/../vendor/autoload.php', // local package vendor
    getcwd() . '/vendor/autoload.php',   // Laravel project vendor
];

$loaded = false;
foreach ($autoloadPaths as $path) {
    if (file_exists($path)) {
        require_once $path;
        $loaded = true;
        break;
    }
}

if (!$loaded) {
    fwrite(STDERR, "❌ Autoload file not found. Run 'composer install' in this package or project.\n");
    exit(1);
}

use Symfony\Component\Console\Application;
use HasanHawary\DynamicCli\Console\DCrudMakeCommand;

try {
    // Check if command class exists
    if (!class_exists(DCrudMakeCommand::class)) {
        throw new \RuntimeException("Command class HasanHawary\\DynamicCli\\Console\\DCrudMakeCommand not found.");
    }

    $app = new Application('Dynamic CLI', '1.0.0');
    $app->add(new DCrudMakeCommand());

    $app->run();
} catch (\Throwable $e) {
    fwrite(STDERR, "❌ Exception: " . $e->getMessage() . "\n");
    fwrite(STDERR, $e->getTraceAsString() . "\n");
    exit(1);
}
